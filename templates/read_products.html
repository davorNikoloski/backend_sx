<!-- templates/read_product.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Read Product</title>
    <!-- Add Bootstrap CSS link -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-4">
        <h1>Product Details</h1>
        <!-- Add a button for adding a new product -->
        <a href="/api/secret/add_product" class="btn btn-success mb-3">Add New Product</a>
        <a href="/api/secret/add_category" class="btn btn-success mb-3">Add New Category</a>
        <a href="/api/secret/add_subcategory" class="btn btn-success mb-3">Add New Subcategory</a>

        <a href="/api/secret/read_categories" class="btn btn-success mb-3">Categories List</a>
        <a href="/api/secret/read_subcategories" class="btn btn-success mb-3">Subcategories List</a>

        <a href="/api/secret/read_users" class="btn btn-success mb-3">Users accounts</a>

        <a href="{{ url_for('Auth.logout') }}" class="btn btn-danger mb-3">Logout</a>


        <div class="input-group mb-3">
            <input type="text" id="searchInput" class="form-control" placeholder="Search products...">
            <div class="input-group-append">
                <button class="btn btn-outline-secondary" type="button" id="searchButton">Search</button>
            </div>
        </div>
        <table class="table table-bordered mt-4">
            <thead>
                <tr>
                    <th>PID</th>
                    <th>Name</th>
                    <th>Info</th>
                    <th>Description</th>
                    <th>Color</th>
                    <th>Brand</th>
                    <th>Price</th>
                    <th>Product Number</th>
                    <th>Image</th>
                    <th>Category ID</th>
                    <th>Subcategory ID</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                {% for product in product_list %}
                <tr>
                    <td>{{ product.pid }}</td>
                    <td>{{ product.name }}</td>
                    <td>{{ product.info }}</td>
                    <td>{{ product.description }}</td>
                    <td>{{ product.color }}</td>
                    <td>{{ product.brand }}</td>
                    <td>{{ product.price }}</td>
                    <td>{{ product.productNo }}</td>
                    <td>{{ product.product_path }}</td>
                    {% for category in category_list %}
                    {% if product.cid == category.cid %}
                    <td>{{ product.cid }} - {{ category.name }}</td>
                    {% endif %}
                    {% endfor %}
                    {% for subcategory in subcategory_list %}
                    {% if product.scid == subcategory.scid %}
                    <td>{{ product.scid }} - {{ subcategory.name }}</td>
                    {% endif %}
                    {% endfor %}
                    <td>
                        <!-- Link to the update page for the product -->
                        <a href="/api/secret/update_products/{{ product.pid }}" class="btn btn-primary">Update</a>
                        <form action="/api/secret/delete_product/{{ product.pid }}" method="POST" class="d-inline">
                            <button type="submit" class="btn btn-danger">Delete</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}    
            </tbody>
        </table>
    </div>
</body>

<script>
    $(document).ready(function () {
        // Original table contents
        var originalTable = $('#tableBody').html();

        // Function to filter the table based on search input
        function filterTable(searchValue) {
            var filteredTable = "";
            $('#tableBody tr').each(function () {
                if ($(this).text().toLowerCase().includes(searchValue.toLowerCase())) {
                    filteredTable += $(this).prop('outerHTML');
                }
            });
            $('#tableBody').html(filteredTable);
        }

        // Handle search button click
        $('#searchButton').click(function () {
            var searchInput = $('#searchInput').val();
            filterTable(searchInput);
        });

        // Reset table to original when search input is cleared
        $('#searchInput').keyup(function () {
            if ($(this).val() === "") {
                $('#tableBody').html(originalTable);
            }
        });
    });
</script>
</html>
