<!-- templates/read_product.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Read Product</title>
    <!-- Add Bootstrap CSS link -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
<body>
    <div class="container mt-4">
        <h1>Product Details</h1>
        <!-- Add a button for adding a new product -->
        <a href="/api/secret/add_product" class="btn btn-success mb-3">Add New Product</a>
        <a href="/api/secret/add_category" class="btn btn-success mb-3">Add New Category</a>
        <a href="/api/secret/add_subcategory" class="btn btn-success mb-3">Add New Subcategory</a>

        <a href="/api/secret/read_categories" class="btn btn-success mb-3">Categories List</a>
        <a href="/api/secret/read_subcategories" class="btn btn-success mb-3">Subcategories List</a>

        <a href="/api/secret/read_users" class="btn btn-success mb-3">Users accounts</a>

        <a href="{{ url_for('Auth.logout') }}" class="btn btn-danger mb-3">Logout</a>


        <div class="input-group mb-3">
            <input type="text" id="searchInput" class="form-control" placeholder="Search products...">
            <div class="input-group-append">
                <button class="btn btn-outline-secondary" type="button" id="searchButton">Search</button>
            </div>
        </div>
        <table class="table table-bordered mt-4">
            <thead>
                <tr>
                    <th>PID</th>
                    <th>Name</th>
                    <th>Info</th>
                    <th>Description</th>
                    <th>Color</th>
                    <th>Brand</th>
                    <th>Price</th>
                    <th>Product Number</th>
                    <th>Image</th>
                    <th>Category ID</th>
                    <th>Subcategory ID</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                {% for product in product_list %}
                <tr>
                    <td>{{ product.pid }}</td>
                    <td>{{ product.name }}</td>
             	    <td>
        <div class="text-truncate" style="max-width: 300px;"> <!-- Adjust max-width as needed -->
            {{ product.info }}
        </div>
        <button class="btn btn-link" data-toggle="collapse" data-target="#infoCollapse{{ product.pid }}">
            Read More
        </button>
        <div class="collapse" id="infoCollapse{{ product.pid }}">
            {{ product.info }}
        </div>
    </td>
    <td>
        <div class="text-truncate" style="max-width: 300px;"> <!-- Adjust max-width as needed -->
            {{ product.description }}
        </div>
        <button class="btn btn-link" data-toggle="collapse" data-target="#descriptionCollapse{{ product.pid }}">
            Read More
        </button>
        <div class="collapse" id="descriptionCollapse{{ product.pid }}">
            {{ product.description }}
        </div>
    </td>

                    <td>{{ product.color }}</td>
                    <td>{{ product.brand }}</td>
                    <td>{{ product.price }}</td>
                    <td>{{ product.productNo }}</td>
                    <td>{{ product.product_path }}</td>
                    <td>{{ product.product_paths }}</td>

                    {% for category in category_list %}
                    {% if product.cid == category.cid %}
                    <td>{{ product.cid }} - {{ category.name }}</td>
                    {% endif %}
                    {% endfor %}
                    {% for subcategory in subcategory_list %}
                    {% if product.scid == subcategory.scid %}
                    <td>{{ product.scid }} - {{ subcategory.name }}</td>
                    {% endif %}
                    {% endfor %}
                    <td>
                        <!-- Link to the update page for the product -->
                        <a href="/api/secret/update_products/{{ product.pid }}" class="btn btn-primary">Update</a>
                        <form action="/api/secret/delete_product/{{ product.pid }}" method="POST" class="d-inline">
                            <button type="submit" class="btn btn-danger">Delete</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}    
            </tbody>
        </table>
        <div>


            <form method="post" action="/api/csv/category_csv" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="csvFile">Upload CSV File for Category:</label>
                    <input type="file" class="form-control-file" id="csvFile" name="csvFile">
                </div>
                <button type="submit" class="btn btn-primary">Upload CSV</button>
            </form>
            <form method="post" action="/api/csv/subcategory_csv" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="csvFile">Upload CSV File for Subcategory:</label>
                    <input type="file" class="form-control-file" id="csvFile" name="csvFile">
                </div>
                <button type="submit" class="btn btn-primary">Upload CSV</button>
            </form>
            <form method="post" action="/api/csv/product_csv" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="csvFile">Upload CSV File for Products:</label>
                    <input type="file" class="form-control-file" id="csvFile" name="csvFile">
                </div>
		<div class="form-group">
        		<label for="sourceFolder">Source Folder for Images:</label>
        		<input type="text" class="form-control" id="sourceFolder" name="sourceFolder">
    		</div>
                <button type="submit" class="btn btn-primary">Upload CSV</button>
            </form>

        </div>
       
    </div>
<script>
    $(document).ready(function() {
        // Initialize Bootstrap's collapse component
        $('.collapse').collapse();
    });
</script>


</body>

<script>
    $(document).ready(function () {
        // Original table contents
        var originalTable = $('#tableBody').html();

        // Function to filter the table based on search input
        function filterTable(searchValue) {
            var filteredTable = "";
            $('#tableBody tr').each(function () {
                if ($(this).text().toLowerCase().includes(searchValue.toLowerCase())) {
                    filteredTable += $(this).prop('outerHTML');
                }
            });
            $('#tableBody').html(filteredTable);
        }

        // Handle search button click
        $('#searchButton').click(function () {
            var searchInput = $('#searchInput').val();
            filterTable(searchInput);
        });

        // Reset table to original when search input is cleared
        $('#searchInput').keyup(function () {
            if ($(this).val() === "") {
                $('#tableBody').html(originalTable);
            }
        });
    });
</script>
</html>
